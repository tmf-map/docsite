---
title: Hook
---

> Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚

## Why do we need Hook?

Hook çš„å‡ºç°ï¼Œå°±ä»£è¡¨äº†å®ƒè¦è§£å†³ä¸€äº› class ç»„ä»¶çš„ç¼ºé™·æˆ–è€…ä¸è¶³ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ class ç»„ä»¶æœ‰ä»€ä¹ˆä¸è¶³æˆ–è€…é—®é¢˜å­˜åœ¨ï¼š

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | ç¼ºç‚¹ | Hook |
| --- | --- | --- | --- |
| 1.`this` æŒ‡å‘é—®é¢˜ | åŒ¿åå‡½æ•° | æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„å‡½æ•°ï¼Œå­ç»„ä»¶é‡å¤ä¸å¿…è¦æ¸²æŸ“ | å‡½æ•°æ—  `this` æŒ‡å‘é—®é¢˜ |
|  | `bind` | éœ€è¦å†™å¾ˆå¤šè·Ÿé€»è¾‘ã€çŠ¶æ€æ— å…³çš„ä»£ç  |  |
| 2.ç”Ÿå‘½å‘¨æœŸç¹ç | æ—  |  | `useEffect` å°†ä¸‰è€…åˆä½“ç®€åŒ– |
| 3.ç”Ÿå‘½å‘¨æœŸå†…é€»è¾‘è‡ƒè‚¿ | æ—  |  | å¤šä¸ª `useEffect` æ¥ç»†åˆ†é€»è¾‘ |
| 4.é€»è¾‘éš¾ä»¥å¤ç”¨ | é€šè¿‡ç»§æ‰¿è§£å†³ | ä¸æ”¯æŒå¤šç»§æ‰¿ | è‡ªå®šä¹‰ Effect Hook |
|  | é€šè¿‡ HOC è§£å†³ | ä¼šå¢åŠ é¢å¤–çš„ç»„ä»¶åµŒå¥—ï¼Œä¹Ÿä¼šæœ‰ä¸€äº›æ€§èƒ½å½±å“ |  |
|  | æ¸²æŸ“å±æ€§ | åŒä¸Šã€å±‚çº§è‡ƒè‚¿ã€æ€§èƒ½å½±å“ |  |

å½“ç„¶ï¼ŒHook æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œç”¨çš„å¥½è‡ªå·±èƒ½å¤Ÿè¾¾åˆ°æ•ˆæœï¼Œç”¨çš„ä¸å¥½åè€Œä¼šé™ä½å¼€å‘æ•ˆç‡å’Œè´¨é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ç”¨æ›´å¥½åœ°ä½¿ç”¨ Hook ã€‚

## useState

### ä¸€ä¸ªä¾‹å­

çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åˆ†è§£æ¥çœ‹åˆ°åº• state hook åšäº†ä»€ä¹ˆï¼š

```jsx
import {useState} from 'react';

function Example() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

### å£°æ˜çŠ¶æ€

```jsx
import {useState} from 'react';

function Example() {
  const [count, setCount] = useState(0);
}
```

`useState` æ˜¯ React è‡ªå¸¦çš„ä¸€ä¸ª Hook å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç”¨æ¥å£°æ˜çŠ¶æ€å˜é‡ã€‚ `useState` è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯æˆ‘ä»¬çš„çŠ¶æ€åˆå§‹å€¼ï¼ˆinitial stateï¼‰ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¬¬ `[0]` é¡¹æ˜¯å½“å‰å½“å‰çš„**çŠ¶æ€å€¼**ï¼Œç¬¬ `[1]` é¡¹æ˜¯å¯ä»¥æ”¹å˜çŠ¶æ€å€¼çš„**æ–¹æ³•å‡½æ•°**ã€‚

æ‰€ä»¥æˆ‘ä»¬åšçš„äº‹æƒ…å…¶å®å°±æ˜¯ï¼Œå£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡ `count` ï¼ŒæŠŠå®ƒçš„åˆå§‹å€¼è®¾ä¸º 0ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªå¯ä»¥æ›´æ”¹ `count` çš„å‡½æ•° `setCount` ã€‚

### è¯»å–çŠ¶æ€

```jsx
<p>You clicked {count} times</p>
```

å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬çš„çŠ¶æ€ `count` å°±æ˜¯ä¸€ä¸ªå•çº¯çš„å˜é‡è€Œå·²ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦å†™æˆ`{this.state.count}`è¿™æ ·äº†ã€‚

### æ›´æ–°çŠ¶æ€

```jsx
<button onClick={() => setCount(count + 1)}>Click me</button>
```

å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨ `setCount` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯ä¿®æ”¹è¿‡çš„æ–°çŠ¶æ€å€¼ã€‚æ¥ä¸‹æ¥çš„äº‹æƒ…å°±äº¤ç»™ React äº†ï¼ŒReact å°†ä¼šé‡æ–°æ¸²æŸ“æˆ‘ä»¬çš„ `Example` ç»„ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯æ›´æ–°åçš„æ–°çš„çŠ¶æ€ï¼Œå³ `count=1` ã€‚è¿™é‡Œæˆ‘ä»¬è¦åœä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼Œ `Example` æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆå®ƒå¯ä»¥è®°ä½ä¹‹å‰çš„çŠ¶æ€ï¼Ÿ

### å¤šä¸ªçŠ¶æ€

é¦–å…ˆï¼ŒuseState æ˜¯å¯ä»¥å¤šæ¬¡è°ƒç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥è¿™æ ·å†™ï¼š

```js
function ExampleWithManyStates() {
  const [age, setAge] = useState(42);
  const [fruit, setFruit] = useState('banana');
  const [todos, setTodos] = useState([{text: 'Learn Hook'}]);
}
```

å…¶æ¬¡ï¼Œ `useState` æ¥æ”¶çš„åˆå§‹å€¼æ²¡æœ‰è§„å®šä¸€å®šè¦æ˜¯ `string/number/boolean` è¿™ç§ç®€å•æ•°æ®ç±»å‹ï¼Œå®ƒå®Œå…¨**å¯ä»¥æ¥æ”¶å¯¹è±¡æˆ–è€…æ•°ç»„ä½œä¸ºå‚æ•°**ã€‚æœ€åï¼ŒReact ä¹Ÿç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª `useReducer` çš„ hook ï¼Œå¦‚æœä½ æ›´å–œæ¬¢ Redux å¼çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆçš„è¯ã€‚

:::caution

ä¹‹å‰æˆ‘ä»¬çš„ `this.setState` åšçš„æ˜¯**åˆå¹¶çŠ¶æ€**åè¿”å›ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œè€Œ `useState` æ˜¯ç›´æ¥**æ›¿æ¢**è€çŠ¶æ€åè¿”å›æ–°çŠ¶æ€ã€‚

:::

ä» `ExampleWithManyStates` å‡½æ•°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ `useState` æ— è®ºè°ƒç”¨å¤šå°‘æ¬¡ï¼Œç›¸äº’ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚è¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ

å…¶å®æˆ‘ä»¬çœ‹ Hook çš„â€œå½¢æ€â€ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¹‹å‰è¢«å®˜æ–¹å¦å®šæ‰çš„ Mixins è¿™ç§æ–¹æ¡ˆï¼Œéƒ½æ˜¯æä¾›ä¸€ç§â€œæ’æ‹”å¼çš„åŠŸèƒ½æ³¨å…¥â€çš„èƒ½åŠ›ã€‚è€Œ Mixins ä¹‹æ‰€ä»¥è¢«å¦å®šï¼Œæ˜¯å› ä¸º**Mixins æœºåˆ¶æ˜¯è®©å¤šä¸ª Mixins å…±äº«ä¸€ä¸ªå¯¹è±¡çš„æ•°æ®ç©ºé—´**ï¼Œè¿™æ ·å°±å¾ˆéš¾ç¡®ä¿ä¸åŒ Mixins ä¾èµ–çš„çŠ¶æ€ä¸å‘ç”Ÿå†²çªã€‚

:::tip

æ¯ä¸€ä¸ª hook éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œ**ä¸åŒç»„ä»¶è°ƒç”¨åŒä¸€ä¸ª hook ä¹Ÿèƒ½ä¿è¯å„è‡ªçŠ¶æ€çš„ç‹¬ç«‹æ€§ã€‚**è¿™å°±æ˜¯ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«äº†ã€‚

:::

### æ€ä¹ˆä¿è¯å¤šä¸ª useState çš„ç›¸äº’ç‹¬ç«‹

è¿˜æ˜¯çœ‹ä¸Šé¢ç»™å‡ºçš„ `ExampleWithManyStates` ä¾‹å­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†ä¸‰æ¬¡`useState` ï¼Œæ¯æ¬¡æˆ‘ä»¬ä¼ çš„å‚æ•°åªæ˜¯ä¸€ä¸ªå€¼ï¼ˆå¦‚ 42ï¼Œ'banana'ï¼‰ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰å‘Šè¯‰ React è¿™äº›å€¼å¯¹åº”çš„ key æ˜¯å“ªä¸ªï¼Œé‚£ React æ˜¯æ€ä¹ˆä¿è¯è¿™ä¸‰ä¸ª `useState` æ‰¾åˆ°å®ƒå¯¹åº”çš„ state å‘¢ï¼Ÿ

:::tip

React æ˜¯æ ¹æ® `useState` å‡ºç°çš„é¡ºåºæ¥å®šçš„ã€‚

:::

æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ï¼š

```js
//ç¬¬ä¸€æ¬¡æ¸²æŸ“
useState(42); //å°†ageåˆå§‹åŒ–ä¸º42
useState('banana'); //å°†fruitåˆå§‹åŒ–ä¸ºbanana
useState([{text: 'Learn Hook'}]); //...

//ç¬¬äºŒæ¬¡æ¸²æŸ“
useState(42); //è¯»å–çŠ¶æ€å˜é‡ageçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°42ç›´æ¥è¢«å¿½ç•¥ï¼‰
useState('banana'); //è¯»å–çŠ¶æ€å˜é‡fruitçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°bananaç›´æ¥è¢«å¿½ç•¥ï¼‰
useState([{text: 'Learn Hook'}]); //...
```

å‡å¦‚æˆ‘ä»¬æ”¹ä¸€ä¸‹ä»£ç ï¼š

```js
let showFruit = true;
function ExampleWithManyStates() {
  const [age, setAge] = useState(42);

  if (showFruit) {
    const [fruit, setFruit] = useState('banana');
    showFruit = false;
  }

  const [todos, setTodos] = useState([{text: 'Learn Hook'}]);
}
```

è¿™æ ·ä¸€æ¥ï¼š

```js
//ç¬¬ä¸€æ¬¡æ¸²æŸ“
useState(42); //å°†ageåˆå§‹åŒ–ä¸º42
useState('banana'); //å°†fruitåˆå§‹åŒ–ä¸ºbanana
useState([{text: 'Learn Hook'}]); //...

//ç¬¬äºŒæ¬¡æ¸²æŸ“
useState(42); //è¯»å–çŠ¶æ€å˜é‡ageçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°42ç›´æ¥è¢«å¿½ç•¥ï¼‰
// useState('banana');
useState([{text: 'Learn Hook'}]); //è¯»å–åˆ°çš„å´æ˜¯çŠ¶æ€å˜é‡fruitçš„å€¼ï¼Œå¯¼è‡´æŠ¥é”™
```

:::bad

React è§„å®šæˆ‘ä»¬å¿…é¡»æŠŠ hook å†™åœ¨å‡½æ•°çš„æœ€å¤–å±‚ï¼Œä¸èƒ½å†™åœ¨ `if-else` ç­‰æ¡ä»¶è¯­å¥å½“ä¸­ï¼Œæ¥ç¡®ä¿ hook çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚

:::

## useEffect

### è§£å‰–å›¾

<Img style={{border: "1px solid #eee"}} src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/hook-structure.png'/>

ä»£ç çš„æ‰§è¡Œé¡ºåºï¼Œç®€åŒ–å¦‚ä¸‹ï¼š

<Img w={450} src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/0wN6Tf.png' />

Online Example: https://stackblitz.com/edit/react-xzwcgp

### ç”Ÿå‘½å‘¨æœŸ

`useState` åªæ˜¯è®©å‡½æ•°ç»„ä»¶å…·æœ‰ä½¿ç”¨ state çš„èƒ½åŠ›ï¼Œé‚£æˆ‘ä»¬è¦è§£å†³ class ç»„ä»¶å­˜åœ¨çš„é—®é¢˜ï¼Œå…ˆæ¥è§£å†³ç”Ÿå‘½å‘¨æœŸè‡ƒè‚¿çš„é—®é¢˜ã€‚å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œç»„ä»¶åœ¨çŠ¶æ€æ›´æ–°çš„æ—¶å€™æ”¹å˜ `document.title`ï¼Œåœ¨ä»¥å‰æˆ‘ä»¬ä¼šè¿™æ ·å†™ä»£ç ï¼š

```jsx
class Example extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }

  componentDidMount() {
    document.title = `You clicked ${this.state.count} times`;
  }

  componentDidUpdate() {
    document.title = `You clicked ${this.state.count} times`;
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({count: this.state.count + 1})}>
          Click me
        </button>
      </div>
    );
  }
}
```

æˆ‘ä»¬å†™çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼Œé€šå¸¸ä¼šäº§ç”Ÿå¾ˆå¤šçš„å‰¯ä½œç”¨ï¼ˆSide Effectï¼‰ï¼Œæ¯”å¦‚å‘èµ· ajax è¯·æ±‚è·å–æ•°æ®ï¼Œæ·»åŠ ä¸€äº›ç›‘å¬çš„æ³¨å†Œå’Œå–æ¶ˆæ³¨å†Œï¼Œæ‰‹åŠ¨ä¿®æ”¹ DOM ç­‰ç­‰ã€‚**æˆ‘ä»¬ä¹‹å‰éƒ½æŠŠè¿™äº›å‰¯ä½œç”¨çš„å‡½æ•°å†™åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°é’©å­é‡Œ**ã€‚ç°åœ¨ä½¿ç”¨ hook æ”¹å†™ä»¥ä¸Šä»£ç ï¼š

```jsx
import {useState, useEffect} from 'react';

function Example() {
  const [count, setCount] = useState(0);

  // ç±»ä¼¼äºcomponentDidMount å’Œ componentDidUpdate:
  useEffect(() => {
    // æ›´æ–°æ–‡æ¡£çš„æ ‡é¢˜
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

:::tip

å¯ä»¥å°† `useEffect` çœ‹æˆæ˜¯ `componentDidMount` ï¼Œ `componentDidUpdate` å’Œ `componentWillUnmount` ä¸‰è€…çš„åˆä½“ã€‚

:::

:::caution

å¦‚æœ `useEffect` æ²¡æœ‰è¿”å›å‡½æ•°ï¼Œé‚£ä¹ˆ `componentWillUnmount` çš„æ—¶å€™æ˜¯ä¸ä¼šæ‰§è¡Œ `useEffect`ã€‚

:::

æˆ‘ä»¬å†æ¢³ç†ä¸€éä¸‹é¢ä»£ç çš„é€»è¾‘ï¼š

```jsx
function Example() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });
}
```

é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡ `count` ï¼Œå°†å®ƒçš„åˆå§‹å€¼è®¾ä¸º 0ã€‚ç„¶åæˆ‘ä»¬å‘Šè¯‰ Reactï¼Œæˆ‘ä»¬çš„è¿™ä¸ªç»„ä»¶æœ‰ä¸€ä¸ªå‰¯ä½œç”¨ã€‚æˆ‘ä»¬ç»™ `useEffect` hook ä¼ äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„å‰¯ä½œç”¨ã€‚

åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬çš„å‰¯ä½œç”¨æ˜¯è°ƒç”¨ Browser API æ¥ä¿®æ”¹æ–‡æ¡£æ ‡é¢˜ã€‚å½“ React è¦æ¸²æŸ“æˆ‘ä»¬çš„ç»„ä»¶æ—¶ï¼Œå®ƒä¼šå…ˆè®°ä½æˆ‘ä»¬ç”¨åˆ°çš„å‰¯ä½œç”¨ã€‚ç­‰ React æ›´æ–°äº† DOM ä¹‹åï¼Œå®ƒå†ä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°ã€‚

:::caution

`useEffect` ä¸­å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œä¸ä¼šé˜»ç¢æµè§ˆå™¨æ›´æ–°è§†å›¾ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å‡½æ•°æ˜¯**å¼‚æ­¥**æ‰§è¡Œçš„ï¼Œè€Œä¹‹å‰çš„ `componentDidMount` æˆ– `componentDidUpdate` ä¸­çš„ä»£ç åˆ™æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚

:::

è¿™ç§å®‰æ’å¯¹å¤§å¤šæ•°å‰¯ä½œç”¨è¯´éƒ½æ˜¯åˆç†çš„ï¼Œä½†æœ‰çš„æƒ…å†µé™¤å¤–ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å…ˆæ ¹æ® DOM è®¡ç®—å‡ºæŸä¸ªå…ƒç´ çš„å°ºå¯¸å†é‡æ–°æ¸²æŸ“ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¸Œæœ›è¿™æ¬¡é‡æ–°æ¸²æŸ“æ˜¯åŒæ­¥å‘ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šåœ¨æµè§ˆå™¨çœŸçš„å»ç»˜åˆ¶è¿™ä¸ªé¡µé¢å‰å‘ç”Ÿã€‚

### å‡å°‘ useEffect çš„æ‰§è¡Œ

æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½è¦æ‰§è¡Œä¸€éè¿™äº›å‰¯ä½œç”¨å‡½æ•°ï¼Œæ˜¾ç„¶æ˜¯ä¸ç»æµçš„ã€‚æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„è®¡ç®—å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç»™ `useEffect` ä¼ ç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥å‘Šè¯‰ React åªæœ‰å½“è¿™ä¸ªå‚æ•°çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰æ‰§è¡Œæˆ‘ä»¬ä¼ çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼š

```jsx
useEffect(() => {
  document.title = `You clicked ${count} times`;
}, [count]); // åªæœ‰å½“countçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°æ‰§è¡Œ`document.title`è¿™ä¸€å¥
```

ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥ `[count]` ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå¦‚æœ count çš„å€¼æ˜¯ 5ï¼Œè€Œä¸”æˆ‘ä»¬çš„ç»„ä»¶é‡æ¸²æŸ“çš„æ—¶å€™ `count` è¿˜æ˜¯ç­‰äº 5ï¼ŒReact å°†å¯¹å‰ä¸€æ¬¡æ¸²æŸ“çš„ [5] å’Œåä¸€æ¬¡æ¸²æŸ“çš„ [5] è¿›è¡Œæ¯”è¾ƒã€‚å› ä¸ºæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ç›¸ç­‰çš„(`5 === 5`)ï¼ŒReact ä¼šè·³è¿‡è¿™ä¸ª effectï¼Œè¿™å°±å®ç°äº†æ€§èƒ½çš„ä¼˜åŒ–ã€‚

:::tip

å¦‚æœæ•°ç»„ä¸­æœ‰å¤šä¸ªå…ƒç´ ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªå…ƒç´ å‘ç”Ÿå˜åŒ–ï¼ŒReact ä¹Ÿä¼šæ‰§è¡Œ `useEffect` ã€‚

:::

`useEffect` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š

- ä»€ä¹ˆéƒ½ä¸ä¼ ï¼Œç»„ä»¶æ¯æ¬¡æ¸²æŸ“å’Œæ›´æ–°éƒ½ä¼šè°ƒç”¨ï¼Œç›¸å½“äº `componentDidMount`, `componentDidUpdate` å’Œ `componentWillUnmount`
- ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ `[]` , åªä¼šåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œç›¸å½“äº `componentDidMount` å’Œ `componentWillUnmount`
- ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…æ‹¬å˜é‡ï¼Œåªæœ‰è¿™äº›å˜é‡å˜åŠ¨æ—¶ï¼Œ `useEffect` æ‰ä¼šæ‰§è¡Œ

:::caution

å½“æˆ‘ä»¬ç¬¬äºŒä¸ªå‚æ•°ä¼ ä¸€ä¸ªç©ºæ•°ç»„ `[]` æ—¶ï¼Œè¿™ç§ç”¨æ³•å¯èƒ½å¸¦æ¥ Bugï¼Œå°‘ç”¨ã€‚

:::

ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯ä»¥ä¼ é€’ `props` ï¼Œä¾‹å¦‚ï¼š

```jsx
useEffect(() => {
  console.log(`You clicked times`);
  document.title = `You clicked times`;
}, [props.time]);
```

`time` çš„æ›´æ–°ä¹Ÿä¼šæ‰§è¡Œ `useEffect`ï¼Œå¦å¤–å¯ä»¥å¯ç”¨ [eslint-plugin-react-hooks](https://www.npmjs.com/package/eslint-plugin-react-hooks) ä¸­çš„ [exhaustive-deps](https://github.com/facebook/react/issues/14920) è§„åˆ™ï¼Œè¿™æ · `useEffect` é‡Œé¢è‹¥æœ‰ä¾èµ–çš„å˜é‡ï¼Œæ¯”å¦‚ `count`ï¼Œæ²¡åœ¨ deps æ•°ç»„é‡Œé¢å£°æ˜åˆ™ä¼šå‡ºç°ä»¥ä¸‹è­¦å‘Šå¹¶ç»™å‡ºä¿®å¤å»ºè®®ï¼Œç©ºæ•°ç»„ä¹Ÿæ˜¯ä¼šæç¤ºçš„ï¼š

<img src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/wlmFn7.png'/>

å¦å¤–ï¼Œç”±äºå‰æ–‡æ‰€è¯´ Hook å¯ä»¥åå¤å¤šæ¬¡ä½¿ç”¨ï¼Œç›¸äº’ç‹¬ç«‹ã€‚æ‰€ä»¥ç›¸å¯¹åˆç†çš„åšæ³•æ˜¯ï¼š

:::good

ç»™æ¯ä¸€ä¸ªå‰¯ä½œç”¨ä¸€ä¸ªå•ç‹¬çš„ `useEffect` é’©å­ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›å‰¯ä½œç”¨ä¸å†ä¸€è‚¡è„‘å †åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­é‡Œï¼Œä»£ç å˜å¾—æ›´åŠ æ¸…æ™°ã€‚ä¸€äº›ä¸å¿…è¦çš„ `useEffect` å‡½æ•°ä¹Ÿå¯ä»¥é¿å…ã€‚

:::

### è§£ç»‘ä¸€äº›å‰¯ä½œç”¨

è¿™ç§åœºæ™¯å¾ˆå¸¸è§ï¼Œå½“æˆ‘ä»¬åœ¨ `componentDidMount` é‡Œæ·»åŠ äº†ä¸€ä¸ªæ³¨å†Œï¼Œæˆ‘ä»¬å¾—é©¬ä¸Šåœ¨ `componentWillUnmount` ä¸­ï¼Œä¹Ÿå°±æ˜¯**ç»„ä»¶è¢«æ³¨é”€ä¹‹å‰**æ¸…é™¤æ‰æˆ‘ä»¬æ·»åŠ çš„æ³¨å†Œï¼Œå¦åˆ™**å†…å­˜æ³„æ¼**çš„é—®é¢˜å°±å‡ºç°äº†ã€‚

æ€ä¹ˆæ¸…é™¤å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```jsx
import {useState, useEffect} from 'react';

function FriendStatus(props) {
  const [isOnline, setIsOnline] = useState(null);

  function handleStatusChange(status) {
    setIsOnline(status.isOnline);
  }

  useEffect(() => {
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    // ä¸€å®šæ³¨æ„ä¸‹è¿™ä¸ªé¡ºåºï¼šå‘Šè¯‰ React åœ¨ä¸‹æ¬¡é‡æ–°æ¸²æŸ“ç»„ä»¶ä¹‹åï¼ŒåŒæ—¶æ˜¯ä¸‹æ¬¡è°ƒç”¨ChatAPI.subscribeToFriendStatus ä¹‹å‰æ‰§è¡Œ cleanup
    return function cleanup() {
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    };
  });

  if (isOnline === null) {
    return 'Loading...';
  }
  return isOnline ? 'Online' : 'Offline';
}
```

**ä¸ºä»€ä¹ˆè¦åœ¨ effect ä¸­è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Ÿ** è¿™æ˜¯ effect å¯é€‰çš„æ¸…é™¤æœºåˆ¶ã€‚æ¯ä¸ª effect éƒ½å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ã€‚å¦‚æ­¤å¯ä»¥å°†æ·»åŠ å’Œç§»é™¤è®¢é˜…è¿™äº›ç´§å¯†æ€§æ¯”è¾ƒå¼ºçš„é€»è¾‘æ”¾åœ¨ä¸€èµ·ã€‚å®ƒä»¬éƒ½å±äº effect çš„ä¸€éƒ¨åˆ†ã€‚

**React ä½•æ—¶æ¸…é™¤ effectï¼Ÿ** `componentDidUpdate` + `componentWillUnmount`ã€‚é¦–æ¬¡ä¸æ‰§è¡Œï¼ŒReact ä¼šåœ¨æ‰§è¡Œå½“å‰ effect ä¹‹å‰å¯¹ä¸Šä¸€ä¸ª effect è¿›è¡Œæ¸…é™¤ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ `useEffect` ã€‚

:::tip

å¹¶ä¸æ˜¯å¿…é¡»ä¸º effect ä¸­è¿”å›çš„å‡½æ•°å‘½åã€‚è¿™é‡Œæˆ‘ä»¬å°†å…¶å‘½åä¸º `cleanup` æ˜¯ä¸ºäº†è¡¨æ˜æ­¤å‡½æ•°çš„ç›®çš„ï¼Œä½†å…¶å®ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªç®­å¤´å‡½æ•°æˆ–è€…ç»™èµ·ä¸€ä¸ªåˆ«çš„åå­—ã€‚

:::

:::tip

`useEffect` å¯ä»¥åœ¨ç»„ä»¶æ¸²æŸ“åå®ç°å„ç§ä¸åŒçš„å‰¯ä½œç”¨ã€‚æœ‰äº›å‰¯ä½œç”¨å¯èƒ½éœ€è¦æ¸…é™¤ï¼Œåˆ™éœ€è¦è¿”å›ä¸€ä¸ªå‡½æ•°ã€‚æœ‰äº› effect å¯èƒ½ä¸å¿…æ¸…é™¤ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿”å›å‡½æ•°ã€‚

:::

:::caution

è¿™ç§è§£ç»‘çš„æ¨¡å¼è·Ÿ `componentWillUnmount` ä¸ä¸€æ ·ã€‚ `componentWillUnmount` åªä¼šåœ¨ç»„ä»¶è¢«é”€æ¯å‰æ‰§è¡Œä¸€æ¬¡è€Œå·²ï¼Œè€Œ `useEffect` ï¼Œæ¯æ¬¡ç»„ä»¶æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œä¸€é `useEffect` é‡Œçš„å‡½æ•°ï¼ŒåŒ…æ‹¬è¿”å›çš„ `cleanup` å‡½æ•°ä¹Ÿä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚

:::

### ä¸ºä»€ä¹ˆæ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ useEffect

æˆ‘ä»¬å…ˆçœ‹ä»¥å‰çš„æ¨¡å¼ï¼š

```jsx
componentDidMount() {
  ChatAPI.subscribeToFriendStatus(
    this.props.friend.id,
    this.handleStatusChange
  );
}

componentWillUnmount() {
  ChatAPI.unsubscribeFromFriendStatus(
    this.props.friend.id,
    this.handleStatusChange
  );
}
```

æˆ‘ä»¬åœ¨ `componentDidMount` æ³¨å†Œï¼Œå†åœ¨ `componentWillUnmount` æ¸…é™¤æ³¨å†Œã€‚ä½†å‡å¦‚è¿™æ—¶å€™ `props.friend.id` å˜äº†æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ä¸å¾—ä¸å†æ·»åŠ ä¸€ä¸ª `componentDidUpdate` æ¥å¤„ç†è¿™ç§æƒ…å†µï¼š

```jsx
componentDidUpdate(prevProps) {
  // å…ˆæŠŠä¸Šä¸€ä¸ªfriend.idè§£ç»‘
  ChatAPI.unsubscribeFromFriendStatus(
    prevProps.friend.id,
    this.handleStatusChange
  );
  // å†é‡æ–°æ³¨å†Œæ–°ä½†friend.id
  ChatAPI.subscribeToFriendStatus(
    this.props.friend.id,
    this.handleStatusChange
  );
}
```

çœ‹åˆ°äº†å—ï¼Ÿå¾ˆç¹çï¼Œè€Œæˆ‘ä»¬ä½† `useEffect` åˆ™æ²¡è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒåœ¨æ¯æ¬¡ç»„ä»¶æ›´æ–°åéƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚æ‰€ä»¥ä»£ç çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š

```text
1.é¡µé¢é¦–æ¬¡æ¸²æŸ“
2.æ›¿friend.id=1çš„æœ‹å‹æ³¨å†Œ
3.çªç„¶friend.idå˜æˆäº†2
4.é¡µé¢é‡æ–°æ¸²æŸ“
5.æ¸…é™¤friend.id=1çš„ç»‘å®š
6.æ›¿friend.id=2çš„æœ‹å‹æ³¨å†Œ
...
```

### å¦‚ä½•è·å– previous props

åœ¨[React å®˜æ–¹æ–‡æ¡£](https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state)ä¸­ç»™å‡ºäº†å¦‚ä¸‹æ–¹æ¡ˆï¼š

è‡ªå®šä¹‰ä¸€ä¸ª hookï¼š

```js
function usePrevious(value) {
  const ref = useRef();
  useEffect(() => {
    ref.current = value;
  });
  return ref.current;
}
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ä¸Šè¿° hook å°±å¯ä»¥å¾—åˆ° previous propsï¼š

```js
function Counter() {
  const [count, setCount] = useState(0);
  // ğŸ‘‡ look here
  const prevCount = usePrevious(count);

  return (
    <h1>
      {' '}
      Now: {count}, before: {prevCount}{' '}
    </h1>
  );
}
```

Online Example: https://stackblitz.com/edit/react-sxsbo1

ä¸ºä»€ä¹ˆä¸Šè¿°æ–¹å¼å¯ä»¥è·å– previous props å‘¢ï¼Ÿé¦–å…ˆéœ€è¦ç†è§£`useRef`ã€‚

```js
// class component
class Count extends Component {
  constructor() {
    this.specialVariable = 'SPECIAL_VARIABLE';
  }

  render() {
    return null;
  }
}
```

ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ`Count`ç±»çš„æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„`specialVariable`ã€‚åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨`useRef`å¯ä»¥æ¨¡æ‹Ÿç±»ç»„ä»¶çš„è¿™ç§è¡Œä¸ºï¼š

```js
// functional component

function Count() {
  const specialVariable = useRef('SPECIAL_VARAIBLE');
  // specialVariable resolves to {current: "SPECIAL_VARIABLE"}
  return null;
}
```

`useRef`å¯ä»¥å°†åˆå§‹å€¼å­˜å‚¨ä¸‹æ¥ã€‚ä¾‹å¦‚`useRef("INITIAL_VALUE")`ï¼Œä¼šè¿”å›ä¸€ä¸ªå«`current`å±æ€§çš„å¯¹è±¡ï¼š`{current: "INITIAL_VALUE"}`ã€‚

ä¸æ™®é€šå˜é‡ä¸åŒï¼Œå½“é‡æ–°æ¸²æŸ“`Count`ç»„ä»¶æ—¶ï¼Œä¸ä¼šé‡æ–°è®¡ç®—`specialVariable`ã€‚ä½¿ç”¨`useRef`ï¼Œä¿å­˜åœ¨`ref`å¯¹è±¡ä¸­çš„å€¼åœ¨é‡æ–°æ¸²æŸ“æ—¶ä¿æŒä¸å˜ã€‚è¯¥å€¼ä¸ä¼šé‡æ–°è®¡ç®—ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

æ›´æ–°`ref`å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•æ˜¯ç›´æ¥è®¾ç½®å½“å‰å±æ€§çš„å€¼ï¼š

```js
specialVariable.current = 'NEW_SPECIAL_VARIABLE';
```

å›åˆ°å®˜æ–¹`Counter`çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥é€æ­¥æ‰§è¡Œä¸€ä¸‹ï¼š

1. æ‰§è¡Œ useStateï¼Œç›®å‰`count`çš„å€¼ä¸º`0`

<Img width="500" align="center" src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/function-counter-nocdn.png'/>

2. æ‰§è¡Œ`usePrevious`ï¼Œä¼ å…¥`count`ä¸º`0`ï¼Œ

<Img width="500" align="center" src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/const-prevCount-screenshot-nocdn.png'/>

3. åˆ›å»ºä¸€ä¸ª`ref`å¯¹è±¡ï¼Œåˆå§‹å€¼ä¸º`{current: undefined}`

<Img width="500" align="center" src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/const-ref-useref.png'/>

4. ä¸ä¼šæ‰§è¡Œ`useEffcect`ï¼Œå› ä¸ºå½“`render`å®Œäº†æ‰ä¼šæ‰§è¡Œ`useEffcect`ã€‚æ‰€ä»¥ç›´æ¥æ‰§è¡Œ`return undefined`

<Img width="500" align="center" src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/return-ref-current-nocdn.png'/>

5. `prevCount`æ‹¿åˆ°äº†å€¼ä¸º`undefined`

<Img width="500" align="center" src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/prevCount.png'/>

6. ç»„ä»¶`render`

<Img width="500" align="center" src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/Now-count-before-prevCount-nocdn.png'/>

7. ç»„ä»¶`render`ä»¥åæ‰§è¡Œ`useEffect`ã€‚

<Img width="500" align="center" src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/seven-nocdn.png'/>

8. æ”¹å˜`ref`å¯¹è±¡å­˜å‚¨çš„å€¼ï¼Œå˜ä¸º`{current: 0}`

<Img width="500" align="center" src='https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/eight-value-nocdn.png'/>

:::tip

1. `ref`å¯¹è±¡å°†å§‹ç»ˆè¿”å›`ref.current`ä¸­ä¿å­˜çš„ç›¸åŒå€¼ï¼Œé™¤éæ˜¾å¼æ›´æ–°ã€‚

2. `useEffect`ä»…åœ¨ä½¿ç”¨å‰ä¸€ä¸ªå€¼`render`ç»„ä»¶åè°ƒç”¨ã€‚åªæœ‰æ¸²æŸ“å®Œæˆåï¼Œæ‰ä¼šåœ¨`useEffect`ä¸­æ›´æ–°`ref`å¯¹è±¡ã€‚

:::

## useLayoutEffect

## useCallback

```js
const memoizedCallback = useCallback(
  () => {
    doSomething(a, b);
  },
  [a, b],
);
```

Returns a [memoized](/docs/react/3.optimization/3.3.memo) callback.

Pass an inline callback and an array of dependencies. `useCallback` will return a memoized version of the callback that only changes if one of the dependencies has changed. This is useful when passing callbacks to **optimized child components** that rely on reference equality to prevent unnecessary renders (e.g. `shouldComponentUpdate`). For more detailed usage, please see [re-render](/docs/react/3.optimization/3.4.re-render).

:::tip

`useCallback(fn, deps)` is equivalent to `useMemo(() => fn, deps)`.

:::

**Are Hooks slow because of creating many functions inside?**

NO.

1. In modern browsers, the raw performance of closures compared to classes doesnâ€™t differ significantly except in extreme scenarios.
2. **Idiomatic code using Hooks doesnâ€™t need the deep component tree nesting** that is prevalent in codebases that use higher-order components, render props, and context. With smaller component trees, React has less work to do.
3. In fact, using `useCallback` will cause extra performance loss because of the additional deps change listener.
4. Actually, `useCallback` is not used to avoid the re-creation of internal functions. You can't avoid recreating the inner function with `useCallback`, as explained below:

```jsx live
function Count() {
    const [clickCount, increaseCount] = useState(0);
    // Without using `useCallback`, the inner function is recreated on every render
    const handleClick = () => {
        alert('handleClick');
        increaseCount(clickCount + 1);
    }

    // Using `useCallback`, it will recreate the inner function every render as an argument to `useCallback`
    const handleClickWithuseCallback = useCallback(() => {
        alert('handleClickWithuseCallback');
        increaseCount(clickCount + 1);
    }, [])

    return (
        <div>
            <p>{clickCount}</p>
            <button onClick={handleClick}>Click</button>
            <button onClick={handleClickWithuseCallback}>Click: useCallback</button>
        </div>
    )
}
```


:::note

The array of dependencies is not passed as arguments to the callback. Conceptually, though, thatâ€™s what they represent: every value referenced inside the callback should also appear in the dependencies array. In the future, a sufficiently advanced compiler could create this array automatically.

We recommend using the [exhaustive-deps](https://github.com/facebook/react/issues/14920) rule as part of our [eslint-plugin-react-hooks](https://www.npmjs.com/package/eslint-plugin-react-hooks#installation) package. It warns when dependencies are specified incorrectly and suggests a fix.

:::

## useRef

## Other Official Hooks

Besides above hooks, React also provides other useful hooks as follows: 

- useContext
- useReducer
- useImperativeMethods
- useDebugValue
- [useMemo](/docs/react/3.optimization/3.3.memo#usememo-hook)

For more details see [Hooks API Reference](https://reactjs.org/docs/hooks-reference.html)

## Customized Hooks

ä¸ºä»€ä¹ˆè¦è‡ªå·±å»å†™ä¸€ä¸ª Effect Hooks ? è¿™æ ·æˆ‘ä»¬æ‰èƒ½æŠŠå¯ä»¥å¤ç”¨çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œå˜æˆä¸€ä¸ªä¸ªå¯ä»¥éšæ„æ’æ‹”çš„â€œæ’é”€â€ï¼Œå“ªä¸ªç»„ä»¶è¦ç”¨æ¥ï¼Œæˆ‘å°±æ’è¿›å“ªä¸ªç»„ä»¶é‡Œï¼Œä¸‹é¢çœ‹ä¸€ä¸ªå®˜ç½‘çš„ä¾‹å­ã€‚

å‡å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆæœ‰ä¸€ä¸ªæœ‹å‹åˆ—è¡¨ `FriendListItem` ä¹Ÿéœ€è¦æ˜¾ç¤ºæ˜¯å¦åœ¨çº¿çš„ä¿¡æ¯ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ° `FriendStatus` ä¸­çš„è¿™æ®µé€»è¾‘ï¼š

```jsx
const [isOnline, setIsOnline] = useState(null);

useEffect(() => {
  function handleStatusChange(status) {
    setIsOnline(status.isOnline);
  }

  ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
  return () => {
    ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
  };
});
```

åœ¨ React ä¸­æœ‰ä¸¤ç§æµè¡Œçš„æ–¹å¼æ¥å…±äº«ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘: **Render-Props** å’Œ**é«˜é˜¶ç»„ä»¶**ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Hook æ˜¯å¦‚ä½•åœ¨è®©ä½ ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è§£å†³ç›¸åŒé—®é¢˜çš„ã€‚

### æå–è‡ªå®šä¹‰ Hook

å½“æˆ‘ä»¬æƒ³åœ¨ä¸¤ä¸ªå‡½æ•°ä¹‹é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠå®ƒæå–åˆ°ç¬¬ä¸‰ä¸ªå‡½æ•°ä¸­ã€‚è€Œç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·é€‚ç”¨è¿™ç§æ–¹å¼ã€‚

æˆ‘ä»¬å°†å…¬å…±çš„éƒ¨é—¨æå–å‡ºæ¥ï¼Œæ–°å»ºä¸€ä¸ª `useFriendStatus` çš„ Hook ä¸“é—¨ç”¨æ¥åˆ¤æ–­æŸä¸ª id æ˜¯å¦åœ¨çº¿ã€‚

:::bad

è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ â€œuseâ€ å¼€å¤´ï¼Œä¸éµå¾ªçš„è¯ï¼Œç”±äºæ— æ³•åˆ¤æ–­æŸä¸ªå‡½æ•°æ˜¯å¦åŒ…å«å¯¹å…¶å†…éƒ¨ Hook çš„è°ƒç”¨ï¼ŒReact å°†æ— æ³•è‡ªåŠ¨æ£€æŸ¥ä½ çš„ Hook æ˜¯å¦è¿åäº† [Hook çš„è§„åˆ™](https://zh-hans.reactjs.org/docs/hooks-rules.html)ã€‚

:::

```jsx
import {useState, useEffect} from 'react';

function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);

  function handleStatusChange(status) {
    setIsOnline(status.isOnline);
  }

  useEffect(() => {
    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);
    return () => {
      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);
    };
  });

  return isOnline;
}
```

React ç»„ä»¶ä¸åŒçš„æ˜¯ï¼Œè‡ªå®šä¹‰ Hook ä¸éœ€è¦å…·æœ‰ç‰¹æ®Šçš„æ ‡è¯†ã€‚æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„å†³å®šå®ƒçš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒåº”è¯¥è¿”å›ä»€ä¹ˆï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ªæ­£å¸¸çš„å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚

### ä½¿ç”¨è‡ªå®šä¹‰ Hook

æˆ‘ä»¬ä¸€å¼€å§‹çš„ç›®æ ‡æ˜¯åœ¨ `FriendStatus` å’Œ `FriendListItem` ç»„ä»¶ä¸­å»é™¤é‡å¤çš„é€»è¾‘ï¼Œå³ï¼šè¿™ä¸¤ä¸ªç»„ä»¶éƒ½æƒ³çŸ¥é“å¥½å‹æ˜¯å¦åœ¨çº¿ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»æŠŠè¿™ä¸ªé€»è¾‘æå–åˆ° `useFriendStatus` çš„è‡ªå®šä¹‰ Hook ä¸­ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨å®ƒäº†ï¼š

```jsx
function FriendStatus(props) {
  const isOnline = useFriendStatus(props.friend.id);

  if (isOnline === null) {
    return 'Loading...';
  }
  return isOnline ? 'Online' : 'Offline';
}
```

```jsx
function FriendListItem(props) {
  const isOnline = useFriendStatus(props.friend.id);

  return (
    <li style={{color: isOnline ? 'green' : 'black'}}>{props.friend.name}</li>
  );
}
```

ä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬æ²¡æœ‰å¯¹å…¶è¡Œä¸ºåšä»»ä½•çš„æ”¹å˜ï¼Œæˆ‘ä»¬åªæ˜¯å°†ä¸¤ä¸ªå‡½æ•°ä¹‹é—´ä¸€äº›å…±åŒçš„ä»£ç æå–åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ã€‚**è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§è‡ªç„¶éµå¾ª Hook è®¾è®¡çš„çº¦å®šï¼Œè€Œå¹¶ä¸æ˜¯ React çš„ç‰¹æ€§**ã€‚

**åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¼šå…±äº« state å—ï¼Ÿ**ä¸ä¼šã€‚è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶(ä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼)ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨éƒ½æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚å¦‚æœéœ€è¦å…¬ç”¨çŠ¶æ€ï¼Œå¯ä»¥æŠŠçŠ¶æ€æŒ‚åœ¨çŠ¶æ€æ ‘ä¸Šã€‚

**è‡ªå®šä¹‰ Hook å¦‚ä½•è·å–ç‹¬ç«‹çš„ stateï¼Ÿ**æ¯æ¬¡è°ƒç”¨ Hookï¼Œå®ƒéƒ½ä¼šè·å–ç‹¬ç«‹çš„ stateã€‚ç”±äºæˆ‘ä»¬ç›´æ¥è°ƒç”¨äº† `useFriendStatus` ï¼Œä» React çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬çš„ç»„ä»¶åªæ˜¯è°ƒç”¨äº† `useState` å’Œ `useEffect` ã€‚ æ­£å¦‚æˆ‘ä»¬åœ¨ä¹‹å‰äº†è§£åˆ°çš„ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å¤šæ¬¡è°ƒç”¨ `useState` å’Œ `useEffect` ï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚

é€šè¿‡ä»¥ä¸Šä¾‹å­ä¼šå‘ç°è‡ªå®šä¹‰ Hook çš„åŸºçŸ³è¿˜æ˜¯ `useState` å’Œ `useEffect` ã€‚æ›´å¤šå†…å®¹è¯·[é˜…è¯»å®˜æ–¹](https://zh-hans.reactjs.org/docs/hooks-custom.html#tip-pass-information-between-hooks)ã€‚

## References

1. [React Hook å®˜æ–¹æ–‡æ¡£](https://zh-hans.reactjs.org/docs/hooks-intro.html)
2. [å‘•å¿ƒæ²¥è¡€ï¼Œä¸€æ–‡çœ‹æ‡‚ react hooksï¼Œä½œè€…ï¼šlandluck](https://juejin.im/post/5d985deae51d4577f9285c2f)
3. [30 åˆ†é’Ÿç²¾é€š React ä»Šå¹´æœ€åŠ²çˆ†çš„æ–°ç‰¹æ€§â€”React Hooksï¼Œä½œè€…ï¼šzach5078](https://segmentfault.com/a/1190000016950339)
4. [2019 å¹´äº†ï¼Œæ•´ç†äº† N ä¸ªå®ç”¨æ¡ˆä¾‹å¸®ä½ å¿«é€Ÿè¿ç§»åˆ° React Hooks(æ”¶è—æ…¢æ…¢çœ‹ç³»åˆ—)ï¼Œä½œè€…ï¼š_sx_](https://juejin.im/post/5d594ea5518825041301bbcb#heading-52)
5. [ç²¾è¯»ã€ŠuseEffect å®Œå…¨æŒ‡å—ã€‹ï¼Œä½œè€…ï¼šé»„å­æ¯…](https://juejin.im/post/5c9827745188250ff85afe50)
6. [useEffect æºç è§£æ](https://react.jokcy.me/book/hooks/hooks-use-effect.html)
7. [How to get previous props/state with React Hooks, by Ohans Emmanuel](https://blog.logrocket.com/how-to-get-previous-props-state-with-react-hooks/)
8. [React Hooks API Reference: useCallback](https://reactjs.org/docs/hooks-reference.html#usecallback)
9. [Are Hooks slow because of creating functions in render?](https://reactjs.org/docs/hooks-faq.html#are-hooks-slow-because-of-creating-functions-in-render)
10. [The use of `useCallback` has always been wrong](https://segmentfault.com/a/1190000022988054)
